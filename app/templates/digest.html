{% extends "base.html" %}

{% block title %}
{% if digest %}
    {{ digest.digest_type.title() }} Digest - {{ digest_cet.strftime('%B %d, %Y %H:%M') }} CET
{% else %}
    News Digest
{% endif %}
{% endblock %}

{% block content %}
<div id="digest-content">
    {% if digest %}
    <!-- Digest Header -->
    <div class="digest-header">
        <h1 class="digest-title">
            {{ digest.digest_type.replace('_', ' ').title() }} Digest
        </h1>
        <div class="digest-meta">
            {{ digest_cet.strftime('%A, %B %d, %Y at %H:%M') }} CET
            {% if is_deep_read %}
            <span style="background: #0066cc; color: white; padding: 2px 6px; border-radius: 3px; font-size: 10px; margin-left: 8px;">DEEP READ</span>
            {% endif %}
        </div>
        <div class="digest-stats">
            {{ digest.stories_count }} stories across {{ categories|length }} categories
        </div>
    </div>

    <!-- Categories Grid -->
    <div class="categories-grid">
        {% for category, cat_articles in categories.items() %}
        <div class="category-section category-{{ category }}">
            <div class="section-header">
                <div>
                    {{ category.replace('_', ' ').title() }}
                </div>
                <span class="count">{{ cat_articles|length }}</span>
            </div>
            
            {% for item in cat_articles %}
            {% set article = item.article %}
            <div class="article">
                <div class="article-indicator"></div>
                <div class="article-content">
                    <h3 class="article-title">
                        <a href="{{ article.url }}" 
                           target="_blank" 
                           rel="noopener noreferrer">
                            {{ article.title }}
                        </a>
                    </h3>
                    
                    {% if article.summary %}
                    <p class="article-summary">{{ article.summary }}</p>
                    {% endif %}
                    
                    <div class="article-meta">
                        <span class="article-source">{{ article.source }}</span>
                        {% if item.published_cet %}
                        <span class="article-time">{{ item.published_cet.strftime('%H:%M') }}</span>
                        {% endif %}
                        {% if article.engagement_score and article.engagement_score > 0 %}
                        <span class="article-engagement">{{ "%.1f"|format(article.engagement_score) }}</span>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endfor %}
    </div>

    {% else %}
    <!-- No Digest Available -->
    <div class="no-digest">
        <div class="no-digest-icon">ðŸ“°</div>
        <h2 class="no-digest-title">No Digest Available</h2>
        <p class="no-digest-message">{{ message }}</p>
        <a href="/refresh" class="refresh-btn-alt">
            ðŸ”„ Collect News Now
        </a>
    </div>
    {% endif %}
</div>

<!-- Footer -->
<div class="footer">
    Auto-refresh every 5 minutes â€¢ 
    <a href="/archive">View Archive</a> â€¢ 
    <a href="/debug/status">System Status</a>
</div>

{% endblock %}